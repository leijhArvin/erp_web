<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="./../../lib/layui-v2.5.5/css/layui.css" media="all">
    <link rel="stylesheet" href="./../../css/public.css" media="all">
</head>
<body>
<div id="addGxtype1">

    <div id="addGxtype" style="display: none;     margin-left: 46px;">
        <form action="" class="layui-form" lay-filter="">
            <div class="layui-inline">
                <label class="layui-form-label">工序选择</label>
                <div class="layui-input-inline">
                    <select name="modules" lay-verify="required" lay-search="">
                        <option value="">直接选择或搜索选择</option>
                        <option value="1">组装</option>
                        <option value="2">测试</option>
                        <option value="3">包装</option>
                    </select>
                </div>
            </div>

            <div class="layui-form-item">
                <div class="layui-input-block" style="     margin-left: 184px;  margin-top: 24px;">
                    <a href="javascript:addGxDate()" style="    display: inline-block;
    height: 38px;
    line-height: 38px;
    padding: 0 18px;
    background-color: #009688;
    color: #fff;
    white-space: nowrap;
    text-align: center;
    font-size: 14px;
    border: none;
    border-radius: 2px;
    cursor: pointer;"> 添加</a>
                </div>
            </div>
        </form>
    </div>
</div>
<!--添加模态框-->
<div id="">

    <div id="addSupper" style="display: none;">

        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;   " >
            <legend style="  margin-left: 418px;">生产工序设计单</legend>
        </fieldset>

        <form action="" class="layui-form" lay-filter="">
            <div class="layui-form-item">
                <label class="layui-form-label">产品名称</label>
                <div class="layui-input-inline">
                    <input autocomplete="off" readonly="readonly" style="   border: 0;  width: 307px;" class="layui-input" id="product_name" lay-verify="required" name="product_name"
                           placeholder="" type="text">
                </div>
                <div>
                <label class="layui-form-label" style="    margin-left: 179px;">产品编号</label>
                <div class="layui-input-inline">
                    <input autocomplete="off" readonly="readonly" style="   border: 0;  width: 307px;" class="layui-input" id="design_id" lay-verify="required" name="design_id"
                           placeholder="" type="text">
                </div>
                </div>

            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">设计人</label>
                <div class="layui-input-inline">
                    <input autocomplete="off" style="    width: 307px;" class="layui-input" id="address" lay-verify="required" name="address"
                           placeholder="请输入设计人名称" type="text">
                </div>
            </div>
            <table class="layui-table"  lay-filter="test3" id="test3">

            </table>
            <div class="layui-form-item">
                <label class="layui-form-label">登记人</label>
                <div class="layui-input-inline">
                    <input autocomplete="off" style="     width: 307px;" class="layui-input" id="product_registrant" lay-verify="required" name="product_registrant"
                           placeholder="" type="text">
                </div>
                <div>
                    <label class="layui-form-label" style="    margin-left: 179px;">登记时间</label>
                    <div class="layui-input-inline">
                        <input type="text" name="register_time" id="register_time" autocomplete="off" class="layui-input">
                    </div>

                </div>

            </div>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">设计要求</label>
                <div class="layui-input-block">
                    <textarea placeholder="请输入内容" class="layui-textarea"></textarea>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-input-block" style="    margin-left: 400px;">
                    <button type="submit" class="layui-btn" lay-submit="" lay-filter="supperSub">立即提交</button>
                    <i class="layui-icon" id="addGx"  style="display: inline-block;   height: 38px;    line-height: 38px;   padding: 0 18px;   background-color: #009688;  color: #fff;   white-space: nowrap;  text-align: center;    font-size: 14px;  border: none;   border-radius: 2px;   cursor: pointer;" >添加工序</i>
                </div>


            </div>
        </form>
    </div>
</div>
<blockquote class="layui-elem-quote news_search" style=" border-left: 0px solid #009688;">
    <div class="layui-row">
        <form class="layui-form layui-col-md12 x-so" id="complain_search">
            建档日期:

            <div class="layui-input-inline">
                <input type="text" name="date" id="date1" autocomplete="off" class="layui-input">
            </div>至
            <div class="layui-input-inline">
                <input type="text" name="date" id="date2" autocomplete="off" class="layui-input">
            </div>
            <button id="search" class="layui-btn" lay-submit
                    lay-filter="provinceSearch">
                <i class="layui-icon">&#xe615;</i>
            </button>
        </form>
    </div>
    <table class="layui-hide" id="complainTable" lay-filter="complainList"></table>
</blockquote>

<script type="text/html" id="complain_toolbar">
    <div class="layui-btn-container">


    </div>



</script>

<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">制定设计单</a>
</script>

<script src="./../../lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
<script src="./../../lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
<script src="./../../js/lay-config.js?v=1.0.4" charset="utf-8"></script>
<script src="./../../lib/jq-module/jquery.particleground.min.js" charset="utf-8"></script>
<script src="./../../lib/common/jquery.cookie.min.js" charset="utf-8"></script>
<script src="./../../lib/common/common.js" charset="utf-8"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->

<script type="text/javascript" >
    function addGxDate(){
     var BName =   $(".layui-input").val();

    }
    layui.use(['table','layer','form','laypage'], function(){
        var table = layui.table,
            layer = layui.layer,
            form = layui.form,
            laypage = layui.laypage;

        var tableIns =  table.render({
            id:"provinceReload"
            ,elem: '#complainTable'
            ,url:'http://localhost:8003/production/getAllProduction'
            ,page: true
            ,toolbar: '#complain_toolbar'
            ,cols: [[ //表头
                {type: 'checkbox', fixed: 'left'}
                ,{field: 'design_id', title: '产品编号', width:300, sort: true, fixed: 'left', }
                ,{field: 'product_name', title: '产品名称', width:280}
                ,{field: 'first_kind_id', title: '档次级别', width:200}
                ,{field: 'product_stair_classify', title: 'I级分类', width:200}
                ,{field: 'product_second_classify', title: 'II级分类', width:200}
                ,{field: 'product_tertiary_classify', title: 'III级分类', width:200}
                ,{fixed: 'right', width: 200, align:'center', toolbar: '#barDemo'}
            ]]
            ,limits: [5,10,20,50]
        });

        table.on('toolbar(complainList)', function(obj) {
            var checkStatus = table.checkStatus(obj.config.id),
                data = checkStatus.data;
            data = eval("(" + JSON.stringify(data) + ")");
            switch(obj.event) {
                case 'add':
                    layer.open({
                        maxmin: true,
                        type: 1,//类型 信息
                        area: ['1000px', '500px'],//定义宽和高
                        title: '设计单添加',//题目
                        shadeClose: false,//点击遮罩层关闭
                        content: $('#addSupper')//打开的模态框
                    });
                    break;
                case 'getCheckData':
                    var data = checkStatus.data;
                    layer.alert(JSON.stringify(data));
                    break;
                case 'Supperdeletes':
                    var data = checkStatus.data;
                    var length = checkStatus.data.length;
                    //layer.alert(JSON.stringify(data));
                    if (length == 0) {
                        layer.msg("请选中要删除的行数据");
                    } else {
                        var delIndex1 =        layer.confirm('真的删除选择中这些数据么?', function (index) {
                            var params = "";
                            $.each(data, function (index, item) {
                                if (index == 0) {
                                    params += item.id+',';
                                } else {
                                    params +=  item.id+',';
                                }
                            });

                            params=params.substring(0,params.length-1);
                            $.post("http://127.0.0.1:8005/supper/deleteIds?params="+params,  function (res) {
                                tableIns.reload();
                                layer.msg("删除成功", {
                                    icon: 1
                                });
                            })
                        });
                    }
                    break;
            }
        });

        //监听单元格编辑
        table.on('edit(test3)', function(obj){
            var value = obj.value //得到修改后的值
                ,data = obj.data //得到所在行所有键值
                ,field = obj.field; //得到字段
            layer.msg('[ID: '+ data.id +'] ' + field + ' 字段更改为：'+ value);
        });

        table.on('tool(complainList)', function(obj) {
            var data = obj.data;
            json = JSON.stringify(data);
            switch(obj.event) {
                case 'detail':

                    break;
                case 'edit':


                    table.render({
                        elem: '#test3'
                        ,cols: [[
                            {field:'gsmc', title: '工序名称'}
                            ,{field:'sqzh', title: '工序编号'}
                            ,{field:'sfdy',title: '描述'}
                        ]]
                        ,data: [{
                            "gsmc": "青岛海信网络科技"
                            ,"sqzh": "0000HX0001"
                            ,"sfdy": "已订阅"
                        }]
                    });

                    $("#product_name").val(data.product_name);
                    $("#design_id").val(data.design_id);
                    layer.open({
                        maxmin: true,
                        type: 1,//类型 信息
                        area: ['1000px', '600px'],//定义宽和高
                        title: '设计单添加',//题目
                        content: $('#addSupper')//打开的模态框

                    });
                    break;
                case 'del':
                    var delIndex = layer.confirm('真的删除id为' + data.id + "的信息吗?", function(delIndex) {
                        $.ajax({
                            url: 'http://127.0.0.1:8005/supper/delsupperById?id='+data.id,
                            success: function(suc) {

                                obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
                                layer.close(delIndex);
                                console.log(delIndex);
                                layer.msg("删除成功", {
                                    icon: 1
                                });

                            }
                        });
                        layer.close(delIndex);
                    });
                    break;
            }
        });
        $("#addGx").click(function () {

            layer.open({
                maxmin: true,
                type: 1,//类型 信息
                area: ['500px', '200px'],//定义宽和高
                title: '工序',//题目
                shadeClose: false,//点击遮罩层关闭
                content: $('#addGxtype')//打开的模态框
            });
        })
        //监听提交
        form.on('submit(supperSub)', function(data){
            var edC=  $("#edidId").val();
            if(edC==1){
                $.ajax({
                    url:'http://127.0.0.1:8005/supper/updateSupperById',
                    data:data.field,
                    success: function (data) {
                        layer.msg("提交成功")
                    }
                })
            }
            if(edC!=1){
                $.ajax({
                    url:'http://127.0.0.1:8005/supper/insertSupper',
                    data:data.field,
                    success: function (data) {
                        layer.msg("提交成功")
                    }
                })
                return;
            }
            layer.alert(JSON.stringify(data.field), {
                title: '最终的提交信息'
            })






        });

        form.render();
        form.on('submit(provinceSearch)', function(data) {
            var formData = data.field;
            var serviceCode = formData.serviceCode,
                compOrder = formData.compOrder,
                compType = formData.compType,
                complainState = formData.complainState;
            table.reload('provinceReload', {
                page: {
                    curr: 1
                },

                url: 'http://127.0.0.1:8005/supper/sellName?name='+formData.name,
            });
            return false;
        });

    });


    layui.use(['form', 'layedit', 'laydate'], function(){
        var form = layui.form
            ,layer = layui.layer
            ,layedit = layui.layedit
            ,laydate = layui.laydate;

        //日期
        laydate.render({
            elem: '#date'
        });
        laydate.render({
            elem: '#date1'
        });
        laydate.render({
            elem: '#date2'

        });
        laydate.render({
            elem: '#register_time'

        });



    });
    layui.use('layer', function(){ //独立版的layer无需执行这一句
        var $ = layui.jquery, layer = layui.layer; //独立版的layer无需执行这一句

        //触发事件
        var active = {
            setTop: function(){
                var that = this;
                //多窗口模式，层叠置顶
                layer.open({
                    type: 2 //此处以iframe举例
                    ,title: '当你选择该窗体时，即会在最顶端'
                    ,area: ['390px', '260px']
                    ,shade: 0
                    ,maxmin: true
                    ,offset: [ //为了演示，随机坐标
                        Math.random()*($(window).height()-300)
                        ,Math.random()*($(window).width()-390)
                    ]
                    ,content: '//layer.layui.com/test/settop.html'
                    ,btn: ['继续弹出', '全部关闭'] //只是为了演示
                    ,yes: function(){
                        $(that).click();
                    }
                    ,btn2: function(){
                        layer.closeAll();
                    }

                    ,zIndex: layer.zIndex //重点1
                    ,success: function(layero){
                        layer.setTop(layero); //重点2
                    }
                });
            }
            ,confirmTrans: function(){
                //配置一个透明的询问框
                layer.msg('大部分参数都是可以公用的<br>合理搭配，展示不一样的风格', {
                    time: 20000, //20s后自动关闭
                    btn: ['明白了', '知道了', '哦']
                });
            }
            ,notice: function(){
                //示范一个公告层
                layer.open({
                    type: 1
                    ,title: false //不显示标题栏
                    ,closeBtn: false
                    ,area: '300px;'
                    ,shade: 0.8
                    ,id: 'LAY_layuipro' //设定一个id，防止重复弹出
                    ,btn: ['火速围观', '残忍拒绝']
                    ,btnAlign: 'c'
                    ,moveType: 1 //拖拽模式，0或者1
                    ,content: '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-weight: 300;">你知道吗？亲！<br>layer ≠ layui<br><br>layer只是作为Layui的一个弹层模块，由于其用户基数较大，所以常常会有人以为layui是layerui<br><br>layer虽然已被 Layui 收编为内置的弹层模块，但仍然会作为一个独立组件全力维护、升级。<br><br>我们此后的征途是星辰大海 ^_^</div>'
                    ,success: function(layero){
                        var btn = layero.find('.layui-layer-btn');
                        btn.find('.layui-layer-btn0').attr({
                            href: 'http://www.layui.com/'
                            ,target: '_blank'
                        });
                    }
                });
            }
            ,offset: function(othis){
                var type = othis.data('type')
                    ,text = othis.text();

                layer.open({
                    type: 1
                    ,offset: type //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
                    ,id: 'layerDemo'+type //防止重复弹出
                    ,content: '<div style="padding: 20px 100px;">'+ text +'</div>'
                    ,btn: '关闭全部'
                    ,btnAlign: 'c' //按钮居中
                    ,shade: 0 //不显示遮罩
                    ,yes: function(){
                        layer.closeAll();
                    }
                });
            }
        };

        $('#layerDemo .layui-btn').on('click', function(){
            var othis = $(this), method = othis.data('method');
            active[method] ? active[method].call(this, othis) : '';
        });

    });
</script>


</body>
</html>
