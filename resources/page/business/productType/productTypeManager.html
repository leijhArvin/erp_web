<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>商品类别管理</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../../lib/layui-v2.5.5/css/layui.css" media="all">
    <link rel="stylesheet" href="../../../css/public.css" media="all">
    <link rel="stylesheet" href="../../../lib/plugin/iview/dist/styles/iview.css">
    <link rel="stylesheet" href="../../../lib/plugin/element-ui/style/index.css">
</head>
<body>

<div class="layuimini-container" id="app">
    <div class="layuimini-main">
        <!--搜索开始-->
        <fieldset class="table-search-fieldset">
            <legend>搜索信息</legend>
            <div style="display: flex;justify-content: space-between">
                <div>
                    <el-form ref="formInline" :inline="true" :model="formInline" class="demo-form-inline">
                        <el-form-item label="供应商" prop="supperId">
                            <el-select v-model="formInline.supperId" placeholder="请选择">
                                <el-option :label="item.name" :value="item.id" v-for="item in items"></el-option>
                            </el-select>
                        </el-form-item>
                        <el-form-item label="类别名称" prop="name">
                            <el-input placeholder="请输入类别名称" v-model="formInline.name"></el-input>
                        </el-form-item>
                        <el-form-item>
                            <el-button type="primary" icon="el-icon-search" @click="onSubmit">查询</el-button>
                            <el-button @click="resetForm('formInline')">重置</el-button>
                        </el-form-item>
                    </el-form>
                </div>

                <div>
                    <el-button type="primary" icon="el-icon-plus">添加</el-button>
                </div>
            </div>
        </fieldset>
        <!--搜索结束-->

        <!--数据表格开始-->
        <el-table
                :data="tableData"
                stripe
                border
                v-loading="loading"
                element-loading-text="拼命加载中"
                element-loading-spinner="el-icon-loading"
                element-loading-background="rgba(0, 0, 0, 0.8)"
                style="width: 100%">
            <el-table-column
                    prop="supperName"
                    align="center"
                    label="供应商">
            </el-table-column>
            <el-table-column
                    prop="name"
                    align="center"
                    label="类别名称">
            </el-table-column>
            <el-table-column
                    prop="address"
                    align="center"
                    label="操作">
                <template slot-scope="scope">
                    <el-button
                            size="mini"
                            @click="handleEdit(scope.$index, scope.row)">编辑
                    </el-button>
                    <el-button
                            size="mini"
                            type="danger"
                            @click="handleDelete(scope.$index, scope.row)">删除
                    </el-button>
                </template>
            </el-table-column>
        </el-table>
        <!--数据表格结束-->

        <!--分页-->
        <div style="margin-top: 10px;">
            <el-pagination
                    background
                    layout="sizes, prev, pager, next, jumper, ->, total, slot"
                    :page-size="pageSize"
                    @current-change="currentChange"
                    @size-change="sizeChange"
                    :total="total">
            </el-pagination>
        </div>
        <!--分页-->
    </div>
</div>
<script src="../../../lib/jquery-3.4.1/jquery-3.4.1.min.js"></script>
<script src="../../../lib/plugin/vue/vue.min.js"></script>
<script src="../../../lib/plugin/iview/dist/iview.min.js"></script>
<script src="../../../lib/plugin/element-ui/index.js"></script>
<script src="../../../lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
<script src="../../../lib/plugin/axios/axios.min.js"></script>
<script src="../../../lib/common/jquery.cookie.min.js" charset="utf-8"></script>
<script src="../../../lib/common/common.js" charset="utf-8"></script>
<script>
    let productApi = 'http://127.0.0.1:8005/';
    $(function () {
        // http request 拦截器
        axios.interceptors.request.use(
            config => {
                if (token) { //判断token是否存在
                    config.headers.token = $.cookie("TOKEN");  //将token设置成请求头
                }
                return config;
            },
            err => {
                return Promise.reject(err);
            }
        );

        new Vue({
            el: "#app",
            data: {
                formInline: {
                    name: '',
                    supperId: ''
                },
                items: [],
                tableData: [],
                loading: true,
                page: 1,
                pageSize: 10,
                total: 0
            },
            methods: {
                resetForm(formName) {
                    this.$refs[formName].resetFields();
                },
                sizeChange(currentPageSize) {
                    this.pageSize = currentPageSize;
                    this.initTable();
                },
                currentChange(currentPage) {
                    this.page = currentPage;
                    this.initTable();
                },
                initTable() {
                    axios.get(productApi + "productType/queryAllProductType?page=" + this.page + "&pageSize=" + this.pageSize).then(res => {
                        // 关闭加载层
                        this.loading = false;
                        this.total = res.data.count;
                        this.tableData = res.data.data;
                    });
                },
                initSupplier() {
                    axios.get(productApi + "supper/getAllBasics_supper").then(res => {
                        this.items = res.data;
                    });
                },
                // 查询
                onSubmit() {
                    this.loading = true;
                    axios.get(productApi + "productType/queryAllProductType?page=" + this.page + "&pageSize=" + this.pageSize + "&supperId=" + this.formInline.supperId + "&name=" + this.formInline.name).then(res => {
                        // 关闭加载层
                        this.loading = false;
                        this.total = res.data.count;
                        this.tableData = res.data.data;
                    });
                },
                handleEdit(index, row) {
                    console.log(index, row);
                },
                handleDelete(index, row) {
                    console.log(index, row);
                }
            },
            mounted() {
                this.initTable();
                this.initSupplier();
            }
        });
    })
</script>
</body>
</html>
