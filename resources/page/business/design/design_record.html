<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>table模块快速使用</title>

    <link rel="stylesheet" href="../../../lib/layui-v2.5.5/css/layui.css">
    <script src="../../../lib/jquery-3.4.1/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.bootcss.com/vue/2.6.11/vue.js"></script>
    <script src="../../../lib/layui-v2.5.5/layui.all.js" media="all"></script>
    <script src="https://cdn.bootcss.com/axios/0.19.2/axios.min.js"></script>
    <script src="https://cdn.bootcss.com/qs/6.9.3/qs.min.js"></script>
    <script src="../../../lib/layui-v2.5.5/lay/modules/laydate.js"></script>
    <script src="config/common.js"></script>
</head>
<body>

<div class="layuimini-container">
    <div class="layuimini-main">
        <!--搜索开始-->
        <legend>搜索</legend>
        <div class="layui-form-item">
            <label class="layui-form-label">商品名称</label>
            <div class="layui-input-inline">
                <input autocomplete="off" class="layui-input" id="proname" lay-verify="required" name="proname"
                       placeholder="请输入" type="text">
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">日期选择</label>
                <div class="layui-input-block">
                    <input autocomplete="off" class="layui-input " id="register_time" name="date" type="text">
                </div>
            </div>
            <div class="layui-inline">
                <button class="layui-btn layui-anim layui-anim-scaleSpring " id="search"
                        title="搜索"><i class="layui-icon layui-icon-search"></i></button>
            </div>
        </div>
    </div>
</div>
<script type="text/html" id="record">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="batchDelete">批量删除</button>
        <button class="layui-btn layui-btn-sm" lay-event="addrecord">添加档案</button>
        <button class="layui-btn layui-btn-sm" lay-event="isAll">验证是否全选</button>
    </div>
</script>
<!--表格-->
<table id="design_record" lay-filter="design_record" lay-data="design_record"></table>
<!--操作按钮-->
<script type="text/html" id="bardesign_record">
    <a class="layui-btn layui-btn-xs" lay-event="detail">查看</a>
    <a class="layui-btn  layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs sold" lay-event="Stand_up_and_down">上/下架</a>
</script>

<!--模仿bootstrap的模态框-->
<div id="">
    <div id="detail" style="display: none;">
        <form class="layui-form" action="" lay-filter="example">
            <div class="layui-form-item">
                <label class="layui-form-label">输入框</label>
                <div class="layui-input-block">
                    <input type="text" name="username" lay-verify="title" autocomplete="off" placeholder="请输入标题"
                           class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">密码框</label>
                <div class="layui-input-block">
                    <input type="password" name="password" placeholder="请输入密码" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">文本域</label>
                <div class="layui-input-block">
                    <textarea placeholder="请输入内容" class="layui-textarea" name="desc"></textarea>
                </div>
            </div>

            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button type="button" class="layui-btn layui-btn-normal" @click="l" id="LAY-component-form-setval">
                        赋值
                    </button>
                    <button type="button" class="layui-btn layui-btn-normal" id="LAY-component-form-getval">取值</button>
                    <button type="submit" class="layui-btn" lay-submit="" lay-filter="demo1">立即提交</button>
                </div>
            </div>
        </form>
    </div>
</div>
<script>
    layui.use('laydate', function () {

//执行一个laydate实例

    })
</script>

<script>

    //table组件
    layui.use(['table', 'laydate'], function () {
        var table = layui.table;//引用table
        var laydate = layui.laydate;
        var design_recordTable;
        laydate.render({
            elem: '#register_time' //指定元素
        });
        search();//查询
        function search() {
            $("#search").click(function () {
                var productName = $("#proname").val();//获取用户输入的商品名称
                var registerTime = $("#register_time").val();//获取用户选择的日期
                table.reload('design_record', {//表格重载
                    url: api1 + 'design_record/findPage'
                    , where: {productName: productName, registerTime: registerTime}
                });
            });
        }

        batchDelete();
        function batchDelete() {
            //头工具栏事件
            table.on('toolbar(design_record)', function (obj) {
                var checkStatus = table.checkStatus(obj.config.id);
                switch (obj.event) {
                    case 'batchDelete':
                        var checkStatus = table.checkStatus('design_record'), data = checkStatus.data;
                        if (data.length > 0) {//如果选中了
                            var idx = [];//所有选中的方式
                            for (var i in data) {
                                idx.push(data[i].id);//获取选中的ID
                            }
                            layer.confirm('确定删除选中的吗？', {icon: 3, title: '提示'}, function (index) {
                                $.ajax({//异步提交  批量删除
                                    url: api1 + "design_record/deletebatch",
                                    type: "post",
                                    data: JSON.stringify(idx),
                                    contentType: "application/json",
                                    success: function (result) {//成功
                                        layer.msg(result.message);
                                        tablerecord();//表格加载

                                    },
                                    error: function (result) {//失败
                                        layer.msg(result.message);
                                    }
                                })
                                layer.close(index);//关闭这个提示框
                            });

                        }
                        break;
                    case 'addrecord'://添加
                        var data = checkStatus.data;
                        layer.open({
                            maxmin: true,
                            type: 1,//类型 信息
                            area: ['1000px', '600px'],//定义宽和高
                            title: '查看详细信息',//题目
                            shadeClose: false,//点击遮罩层关闭
                            content: $('#detail')//打开的模态框
                        });
                        break;
                    case 'isAll':
                        layer.msg(checkStatus.isAll ? '全选' : '未全选');
                        break;
                }
                ;
            });
        }

        tablerecord();//表格加载数据
        function tablerecord() {
            design_recordTable = table.render({
                elem: '#design_record' //示例table的Id
                , height: 500 //表格高度
                , url: api1 + 'design_record/findPage' //数据接口
                , toolbar: '#record' //开启头部工具栏，并为其绑定左侧模板
                , request: {
                    pageName: 'page' //页码的参数名称，默认：page
                    , limitName: 'pageSize' //每页数据量的参数名，默认：limit
                }
                , response: {
                    countName: 'total' //规定数据总数的字段名称，默认：count 规定返回数据的总行数实例
                    , dataName: 'rows' //规定数据列表的字段名称，默认：data 规定返回的数据示例
                }
                , parseData: function (res) { //res 即为原始返回的数据
                    return {
                        "code": "0", //返回的code的值 成功：0
                        "total": res.total, //解析数据长度
                        "rows": res.rows, //解析数据列表
                    };
                }
                , page: {//开启分页 设置分页样式
                    layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'] //自定义分页布局
                    , groups: 1 //只显示 1 个连续页码
                    , first: false //不显示首页
                    , last: false //不显示尾页
                }

                , title: '产品档案登记'//excel导出的标题
                , totalRow: true //开启合计行
                , cols:
                    [[ //表头
                        {type: 'checkbox', fixed: 'left'} //开启多选
                        , {field: 'id', title: 'ID', type: "numbers", minWidth: 90, hide: true}
                        , {field: 'productId', type: "numbers", title: '商品ID', width: 90, totalRowText: '合计'}
                        , {field: 'productName', title: '商品名称', minWidth: 90, edit: 'text'}
                        , {field: 'factoryName', title: '制造商', minWidth: 90,}
                        , {field: 'costPrice', title: '计划成本单价', minWidth: 90, sort: true, hide: true, totalRow: true}
                        , {field: 'listPrice', title: '市场单价', minWidth: 90, sort: true, hide: true, totalRow: true}
                        , {
                            field: 'realCostPrice',
                            title: '成本单价',
                            minWidth: 90,
                            edit: 'text', //单元格可编辑
                            sort: true, //排序
                            hide: true, //是否开启隐藏
                            totalRow: true //开启合计
                        }
                        , {field: 'amountUnit', title: '单位', minWidth: 60, hide: true}
                        , {field: 'responsiblePerson', minWidth: 90, title: '产品经理', hide: true}
                        , {field: 'register', title: '登记人', minWidth: 90, edit: 'text'}
                        , {field: 'registerTime', title: '建档时间', minWidth: 100, sort: true, hide: true}
                        , {field: 'checkTag', title: '审核标志', minWidth: 90, hide: true}
                        , {field: 'changeTag', title: '档案变更标志', minWidth: 100}
                        , {field: 'priceChangeTag', title: '价格变更标志', minWidth: 100}
                        , {field: 'deleteTag', title: '是否下架', hide: true, minWidth: 90}
                        , {field: 'firstKindName', title: '一级分类', hide: true, minWidth: 90}
                        , {field: 'secondKindName', title: '二级分类', hide: true, minWidth: 90}
                        , {field: 'priceChangeTag', title: '价格变更标志', hide: true, minWidth: 100}
                        , {field: 'productClass', title: '档次级别', hide: true, minWidth: 90}
                        , {field: 'productDescribe', title: '产品描述', hide: true, minWidth: 90}
                        , {field: 'type', title: '类型', hide: true, minWidth: 90}
                        , {field: 'responsiblePerson', title: '产品经理', hide: true, minWidth: 90}
                        , {field: 'warranty', title: '保修期', hide: true, minWidth: 90}
                        , {field: 'fileChangeAmount', title: '变更次数', hide: true, minWidth: 90, totalRow: true}
                        , {field: 'priceChangeTag', title: '价格变更标志', hide: true, minWidth: 100}
                        , {fixed: 'right', width: 180, fixed: 'right', toolbar: '#bardesign_record'}//右侧操作按钮
                    ]]
            });

        }


        toolRecorde();
        function toolRecorde() {
            //监听工具条
            table.on('tool(design_record)', function (obj) {
                var data = obj.data; //获得当前行数据
                var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
                var tr = obj.tr; //获得当前行 tr 的 DOM 对象（如果有的话）
                var jsonData = JSON.stringify(data);//json转换后的json
                if (layEvent === 'detail') { //查看

                } else if (layEvent === 'Stand_up_and_down') { //上下架
                    var tag = "";//获取上下架信息
                    var dataTag = "";//修改上下信息
                    if (data.deleteTag == "已下架") {
                        tag = "上架";
                        data.deleteTag = "已上架"
                    } else {
                        tag = "下架";
                        data.deleteTag = "已下架"
                    }
                    layer.confirm("确定" + tag + "吗？", {icon: 3, title: '提示'}, function (index) {
                        $.ajax({
                            url: api1 + "design_record/putawayrecord",
                            data: JSON.stringify(data),//转json
                            type: "post",//post提交方式
                            contentType: "application/json",//json提交
                            success: function (result) {
                                layer.msg(result.message);
                                tablerecord();
                            },
                            error: function (result) {
                                layer.msg(result.message);
                            }
                        });
                        layer.close(index);
                    });

                } else if (layEvent === 'edit') { //修改档案
                    layer.confirm('确定修改吗 ?', {icon: 3, title: '提示'}, function (index) {
                        $.ajax({
                            url: api1 + "design_record/updaterecordById",
                            data: jsonData,
                            type: "post",
                            contentType: "application/json",
                            success: function (result) {
                                layer.msg(result.message);
                            },
                            error: function (result) {
                                layer.msg(result.message);
                            }
                        });
                        layer.close(index);
                    });
                }
            });
        }
    });
</script>


</body>
</html>
