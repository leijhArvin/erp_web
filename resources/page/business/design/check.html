<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>档案审核</title>
    <!-- import CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="../../../lib/layui-v2.5.5/css/layui.css">
    <link href="https://cdn.bootcss.com/element-ui/2.8.2/theme-chalk/index.css" rel="stylesheet">
    <!-- 2. 引入vue和vue-router-->
    <script src="https://cdn.bootcss.com/vue/2.6.10/vue.js"></script>
    <!-- 未使用vue路由功能可不导入 -->
    <script src="https://cdn.bootcss.com/vue-router/3.0.6/vue-router.js"></script>
    <!-- 3. 引入ElementUI组件 -->
    <script src="https://cdn.bootcss.com/element-ui/2.8.2/index.js"></script>
    <script src="../../../lib/layui-v2.5.5/layui.all.js"></script>
    <script src="../../../lib/layui-v2.5.5/layui.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/axios/0.19.2/axios.js"></script>
    <script src="../../../lib/jquery-3.4.1/jquery-3.4.1.min.js"></script>
    <script src="../../../lib/common/jquery.cookie.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/qs/6.9.3/qs.js"></script>
    <script src="config/common.js"></script>
    <style>
        .demo-table-expand {
            font-size: 0;
        }

        .demo-table-expand label {
            width: 90px;
            color: #99a9bf;
        }

        .demo-table-expand .el-form-item {
            margin-right: 0;
            margin-bottom: 0;
            width: 50%;
        }
    </style>
    <link rel="stylesheet" href="../../../lib/bootstarp/css/bootstrap.css">
    <script src="../../../lib/bootstarp/js/bootstrap.js"></script>


</head>
<body>
<div id="app">
    <div>
        <fieldset class="layui-elem-field">
            <legend>搜索信息</legend>
            <div class="layui-field-box" style="margin-left: 300px ">
                <label for="">名称： </label>
                <el-input v-model="record.productName" style="display: inline-block;width: 200px"
                          placeholder="产品档案名称"></el-input>
                <label for="">日期： </label>
                <el-date-picker
                        v-model="record.registerTime"
                        type="date"
                        value-format="yyyy-MM-dd"
                        placeholder="选择建档日期">
                </el-date-picker>
                <el-button type="primary" @click="findPage()" icon="el-icon-search">搜索</el-button>
            </div>
        </fieldset>
        <el-tabs v-model="activeName" @tab-click="handleClick">
            <el-tab-pane label="待审核" name="等待审核">
                <div>
                    <el-table
                            :data="recordList"
                            ref="multipleTable"
                            v-loading="loading"
                            border
                            @selection-change="handleSelectionChange"
                            style="width: 100%;margin: 0 auto">
                        <el-table-column
                                type="selection"
                                width="55">
                        </el-table-column>
                        <el-table-column type="expand" label="详细" width="50">
                            <template slot-scope="props">
                                <el-form label-position="left" inline class="demo-table-expand">
                                    <el-form-item label="产品ID">
                                        <span>{{ props.row.productId }}</span>
                                    </el-form-item>
                                    <el-form-item label="产品名称">
                                        <span>{{ props.row.productName }}</span>
                                    </el-form-item>
                                    <el-form-item label="厂商">
                                        <span>{{ props.row.factoryName }}</span>
                                    </el-form-item>
                                    <el-form-item label="配置">
                                        <span>{{ props.row.productClass }}</span>
                                    </el-form-item>
                                    <el-form-item label="保修期">
                                        <span>{{ props.row.warranty }}</span>
                                    </el-form-item>
                                    <el-form-item label="市场单价">
                                        <span>{{ props.row.listPrice }}</span>
                                    </el-form-item>
                                    <el-form-item label="成本单价">
                                        <span>{{ props.row.realCostPrice }}</span>
                                    </el-form-item>
                                    <el-form-item label="单位">
                                        <span>{{ props.row.amountUnit }}</span>
                                    </el-form-item>
                                    <el-form-item label="产品经理">
                                        <span>{{ props.row.responsiblePerson  }}</span>
                                    </el-form-item>
                                    <el-form-item label="登记人">
                                        <span>{{ props.row.register  }}</span>
                                    </el-form-item>
                                    <el-form-item label="产品描述">
                                        <span>{{ props.row. productDescribe }}</span>
                                    </el-form-item>
                                    <el-form-item label="建档时间">
                                        <span>{{ props.row.registerTime }}</span>
                                    </el-form-item>
                                </el-form>
                            </template>
                        </el-table-column>
                        <el-table-column
                                label="ID"
                                prop="id">
                        </el-table-column>
                        <el-table-column
                                label="商品名称"
                                prop="productName">
                        </el-table-column>
                        <el-table-column
                                label="描述"
                                prop="productDescribe">
                        </el-table-column>
                        <el-table-column
                                fixed="right"
                                label="操作"
                                width="160">
                            <template slot-scope="scope">
                                <el-button-group>
                                    <el-tooltip class="item" effect="dark" content="审核" placement="top-start">
                                        <el-button type="primary" @click="show(scope.row)" data-toggle="modal" data-target="#myModal"
                                                   size="small" icon="el-icon-edit" ></el-button>
                                    </el-tooltip>

                                </el-button-group>
                            </template>
                        </el-table-column>
                    </el-table>
                    <el-pagination
                            @size-change="handleSizeChange"
                            @current-change="handleCurrentChange"
                            :current-page="page"
                            :page-sizes="[10, 20, 30, 40,50,60]"
                            :page-size="pageSize"
                            layout="total, sizes, prev, pager, next, jumper"
                            :total="total">
                    </el-pagination>
                </div>
            </el-tab-pane>
            <el-tab-pane label="审核通过" name="审核通过">
                <div>
                    <el-table
                            :data="recordList"
                            ref="multipleTable"
                            v-loading="loading"
                            border
                            @selection-change="handleSelectionChange"
                            style="width: 100%;margin: 0 auto">
                        <el-table-column
                                type="selection"
                                width="55">
                        </el-table-column>
                        <el-table-column type="expand" label="详细" width="50">
                            <template slot-scope="props">
                                <el-form label-position="left" inline class="demo-table-expand">
                                    <el-form-item label="产品ID">
                                        <span>{{ props.row.productId }}</span>
                                    </el-form-item>
                                    <el-form-item label="产品名称">
                                        <span>{{ props.row.productName }}</span>
                                    </el-form-item>
                                    <el-form-item label="厂商">
                                        <span>{{ props.row.factoryName }}</span>
                                    </el-form-item>
                                    <el-form-item label="配置">
                                        <span>{{ props.row.productClass }}</span>
                                    </el-form-item>
                                    <el-form-item label="保修期">
                                        <span>{{ props.row.warranty }}</span>
                                    </el-form-item>
                                    <el-form-item label="市场单价">
                                        <span>{{ props.row.listPrice }}</span>
                                    </el-form-item>
                                    <el-form-item label="成本单价">
                                        <span>{{ props.row.realCostPrice }}</span>
                                    </el-form-item>
                                    <el-form-item label="单位">
                                        <span>{{ props.row.amountUnit }}</span>
                                    </el-form-item>
                                    <el-form-item label="产品经理">
                                        <span>{{ props.row.responsiblePerson  }}</span>
                                    </el-form-item>
                                    <el-form-item label="登记人">
                                        <span>{{ props.row.register  }}</span>
                                    </el-form-item>
                                    <el-form-item label="产品描述">
                                        <span>{{ props.row. productDescribe }}</span>
                                    </el-form-item>
                                    <el-form-item label="建档时间">
                                        <span>{{ props.row.registerTime }}</span>
                                    </el-form-item>
                                </el-form>
                            </template>
                        </el-table-column>
                        <el-table-column
                                label="ID"
                                prop="id">
                        </el-table-column>
                        <el-table-column
                                label="商品名称"
                                prop="productName">
                        </el-table-column>
                        <el-table-column
                                label="描述"
                                prop="productDescribe">
                        </el-table-column>
                        <el-table-column
                                fixed="right"
                                label="操作"
                                width="160">
                            <template slot-scope="scope">
                                <el-button-group>
                                    <el-tooltip class="item" effect="dark" content="审核" placement="top-start">
                                        <el-button type="primary" @click="show(scope.row)" data-toggle="modal" data-target="#myModal"
                                                   size="small" icon="el-icon-edit"></el-button>
                                    </el-tooltip>
                                </el-button-group>
                            </template>
                        </el-table-column>
                    </el-table>
                    <el-pagination
                            @size-change="handleSizeChange"
                            @current-change="handleCurrentChange"
                            :current-page="page"
                            :page-sizes="[10, 20, 30, 40,50,60]"
                            :page-size="pageSize"
                            layout="total, sizes, prev, pager, next, jumper"
                            :total="total">
                    </el-pagination>
                </div>
            </el-tab-pane>
            <el-tab-pane label="审核未通过" name="审核未通过">
                <div>
                    <el-table
                            :data="recordList"
                            ref="multipleTable"
                            v-loading="loading"
                            border
                            @selection-change="handleSelectionChange"
                            style="width: 100%;margin: 0 auto">
                        <el-table-column
                                type="selection"
                                width="55">
                        </el-table-column>
                        <el-table-column type="expand" label="详细" width="50">
                            <template slot-scope="props">
                                <el-form label-position="left" inline class="demo-table-expand">
                                    <el-form-item label="产品ID">
                                        <span>{{ props.row.productId }}</span>
                                    </el-form-item>
                                    <el-form-item label="产品名称">
                                        <span>{{ props.row.productName }}</span>
                                    </el-form-item>
                                    <el-form-item label="厂商">
                                        <span>{{ props.row.factoryName }}</span>
                                    </el-form-item>
                                    <el-form-item label="配置">
                                        <span>{{ props.row.productClass }}</span>
                                    </el-form-item>
                                    <el-form-item label="保修期">
                                        <span>{{ props.row.warranty }}</span>
                                    </el-form-item>
                                    <el-form-item label="市场单价">
                                        <span>{{ props.row.listPrice }}</span>
                                    </el-form-item>
                                    <el-form-item label="成本单价">
                                        <span>{{ props.row.realCostPrice }}</span>
                                    </el-form-item>
                                    <el-form-item label="单位">
                                        <span>{{ props.row.amountUnit }}</span>
                                    </el-form-item>
                                    <el-form-item label="产品经理">
                                        <span>{{ props.row.responsiblePerson  }}</span>
                                    </el-form-item>
                                    <el-form-item label="登记人">
                                        <span>{{ props.row.register  }}</span>
                                    </el-form-item>
                                    <el-form-item label="产品描述">
                                        <span>{{ props.row. productDescribe }}</span>
                                    </el-form-item>
                                    <el-form-item label="建档时间">
                                        <span>{{ props.row.registerTime }}</span>
                                    </el-form-item>
                                </el-form>
                            </template>
                        </el-table-column>
                        <el-table-column
                                label="ID"
                                prop="id">
                        </el-table-column>
                        <el-table-column
                                label="商品名称"
                                prop="productName">
                        </el-table-column>
                        <el-table-column
                                label="描述"
                                prop="productDescribe">
                        </el-table-column>
                        <el-table-column
                                fixed="right"
                                label="操作"
                                width="160">
                            <template slot-scope="scope">
                                <el-button-group>
                                    <el-tooltip class="item" effect="dark" content="审核" placement="top-start">
                                        <el-button type="primary" @click="show(scope.row)" data-toggle="modal" data-target="#myModal"
                                                   size="small" icon="el-icon-edit"></el-button>
                                    </el-tooltip>
                                </el-button-group>
                            </template>
                        </el-table-column>
                    </el-table>
                    <el-pagination
                            @size-change="handleSizeChange"
                            @current-change="handleCurrentChange"
                            :current-page="page"
                            :page-sizes="[10, 20, 30, 40,50,60]"
                            :page-size="pageSize"
                            layout="total, sizes, prev, pager, next, jumper"
                            :total="total">
                    </el-pagination>
                </div>
            </el-tab-pane>
        </el-tabs>
        <!--查看物料的模态框-->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">物料组成</h4>
                    </div>
                    <div class="modal-body">
                        <blockquote class="layui-elem-quote layui-quote-nm">
                            产品编号：{{proID}}
                            产品名称：{{proName}}
                        </blockquote>
                        <div>
                            <table class="layui-table">
                                <colgroup>
                                    <col width="150">
                                    <col width="200">
                                    <col>
                                </colgroup>
                                <thead>
                                <tr>
                                    <th>物料id</th>
                                    <th>名称</th>
                                    <th>所需数量</th>
                                    <th>描述</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="matarual in matarual_constitute">
                                    <td>{{matarual.materialid}}</td>
                                    <td>{{matarual.materialname}}</td>
                                    <td>{{matarual.materialnum}}</td>
                                    <td>{{matarual.materialremark}}</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <el-button type="primary" @click="checkrecord('审核通过')">审核通过</el-button>
                        <el-button type="warning" @click="checkrecord('审核未通过')">审核不通过</el-button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
</body>
<!-- import Vue before Element -->
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<!-- import JavaScript -->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script>

    layui.use(['layer', 'form'], function () {
        var layer = layui.layer
            , form = layui.form;

        var vm = new Vue({
            el: '#app',
            data: {
                activeName: '等待审核',
                /*加载动画*/
                loading: true,
                page: 1,//页码
                pageSize: 10,//行数
                total: 0,//总记录数
                recordList: [],//展示的数据
                record: {//查询的条件
                    productName: "",//产品名称
                    registerTime: "",//建档时间
                    checkTag:"等待审核",//审核标志
                },
                proID:"",//产品id
                proName:"",//产品名称
                matarual_constitute:[],//物料组成
                checkers:{
                    id:"",
                    checker:"",
                    checkTag:"",
                }
            },
            methods: {

                /*获取点击的tab*/
                handleClick(tab, event) {
                    this.record.checkTag=tab.name;
                    this.findPage();
                },
                /*//获取点击的行数据*/
                recordUpdateList(row) {
                    this.recordUpdates = row;//绑定到修改的实体
                },
                /*分页条件查询*/
                findPage() {
                    axios.post(api1 + "/design_record/findPagecheck?page=" + this.page + "&pageSize=" + this.pageSize, this.record).then(res => {
                        this.total = res.data.total;
                        this.recordList = res.data.data;
                        this.loading=false;
                    }).catch(err => {
                        vm.$message({//异常
                            showClose: true,
                            message: "获取超时，请检查网络",
                            type: 'error'
                        });
                    })
                },
                /*设置行数*/
                handleSizeChange(pageSize) {
                    this.pageSize = pageSize;
                    // console.log(`每页 ${pageSize} 条`);
                },
                /*获取页码*/
                handleCurrentChange(page) {
                    this.page = page;
                    this.findPage();
                },
                /*全选*/
                toggleSelection(rows) {//全选选中
                    if (rows) {
                        rows.forEach(row => {
                            this.$refs.multipleTable.toggleRowSelection(row);
                        });
                    } else {
                        this.$refs.multipleTable.clearSelection();
                    }
                },
                /*获取复选框选中的值*/
                handleSelectionChange(value) {
                    this.deleterecords=value;
                    console.log(this.deleterecords);
                },
                /*查看点击选中行*/
                show(value){
                    this.checkers.id=value.id;
                    this.proID=value.productId
                    this.proName=value.productName;
                    console.log(value);
                    var checker = $.parseJSON(window.localStorage.getItem("user"));
                    this.checkers.checker = checker.name;
                    axios.get(api1+"design_record/selectBymaterielArchivesId?materielArchivesId="+value.materielArchivesId).then(res=>{
                        this.matarual_constitute=res.data;
                    }).catch(err=>{
                        vm.$message({//异常
                            showClose: true,
                            message: "获取超时，请检查网络",
                            type: 'error'
                        });
                    })
                },
                checkrecord(value){//
                    this.checkers.checkTag=value;
                    console.log(this.checkers);
                    if(this.checkers!=null){
                        axios.post(api1+"design_record/updatecheck",this.checkers).then(res=>{
                            if(res.data.success){
                                vm.$message({
                                    showClose: true,
                                    message: res.data.message,
                                    type: 'success'
                                });
                            }else{
                                vm.$message({
                                    showClose: true,
                                    message: res.data.message,
                                    type: 'error'
                                });
                            }
                        }).catch(err=>{
                            vm.$message({//异常
                                showClose: true,
                                message: "系统异常",
                                type: 'error'
                            });
                        })
                    }
                }
            },
            created() {
                /*页面加载*/
                this.findPage();
            }
        });
    });

</script>
</html>
